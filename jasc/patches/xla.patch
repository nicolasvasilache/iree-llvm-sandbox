diff '--color=auto' -ru a/xla/BUILD b/xla/BUILD
--- a/xla/BUILD	2023-06-12 20:50:10.000000000 +0000
+++ b/xla/BUILD	2023-07-11 09:42:42.089247113 +0000
@@ -13,7 +13,7 @@
 
 package(
     # copybara:uncomment default_applicable_licenses = ["//tensorflow:license"],
-    default_visibility = ["//xla:internal"],
+    default_visibility = ["//visibility:public"],
     licenses = ["notice"],
 )
 
diff '--color=auto' -ru a/xla/service/BUILD b/xla/service/BUILD
--- a/xla/service/BUILD	2023-06-12 20:50:10.000000000 +0000
+++ b/xla/service/BUILD	2023-07-10 15:36:23.550756903 +0000
@@ -33,7 +33,7 @@
 
 package(
     # copybara:uncomment default_applicable_licenses = ["//tensorflow:license"],
-    default_visibility = [":friends"],
+    default_visibility = ["//visibility:public"],
     licenses = ["notice"],
 )
 
diff '--color=auto' -ru a/xla/service/cpu/BUILD b/xla/service/cpu/BUILD
--- a/xla/service/cpu/BUILD	2023-06-12 20:50:10.000000000 +0000
+++ b/xla/service/cpu/BUILD	2023-07-10 14:56:23.459895361 +0000
@@ -325,7 +325,6 @@
         "@llvm-project//llvm:Support",
         "@llvm-project//llvm:Target",
         "@llvm-project//llvm:TargetParser",
-        "@llvm-project//llvm:X86CodeGen",  # fixdeps: keep
         "@llvm-project//mlir:AffineDialect",
         "@llvm-project//mlir:AffineToStandard",
         "@llvm-project//mlir:ArithDialect",
@@ -361,6 +360,7 @@
             "@llvm-project//llvm:AArch64CodeGen",  # fixdeps: keep
         ],
         "//conditions:default": [
+            "@llvm-project//llvm:X86CodeGen",  # fixdeps: keep
         ],
     }) + if_llvm_system_z_available([
         "@llvm-project//llvm:SystemZCodeGen",  # fixdeps: keep
@@ -559,6 +559,7 @@
         "@tsl//tsl/platform:env",
         "@tsl//tsl/platform:logging",
     ],
+    visibility = ["//visibility:public"],
 )
 
 cc_library(
diff '--color=auto' -ru a/xla/service/gpu/BUILD b/xla/service/gpu/BUILD
--- a/xla/service/gpu/BUILD	2023-06-12 20:50:10.000000000 +0000
+++ b/xla/service/gpu/BUILD	2023-07-10 15:28:03.306876220 +0000
@@ -30,7 +30,7 @@
 
 package(
     # copybara:uncomment default_applicable_licenses = ["//tensorflow:license"],
-    default_visibility = [":friends"],
+    default_visibility = ["//visibility:public"],
     licenses = ["notice"],
 )
 
